#!/usr/bin/env testml-bash


*makefile.make-out(*command) == *stdout


=== Makefile definition
--- makefile
include $(shell bin/make+)

My-True = true
ot = [[ $1 -ot $2 ]]

YES = yes
NO = no

yes: ; @echo YES
no: ; @echo NO

FILE = $(shell mktemp)

rule1: $(+true) ; @echo OK
+true:

rule2: $(+true!) ; @echo OK

rule3: ${+true(1,'two',?tru)} ; @echo OK

rule4: $(+!false) ; @echo OK
+!false:

rule5: $(+true?yes)

rule6: $(+true?yes!)

rule7: $(+!true|yes)

rule8: $(+false?yes|no)

rule9: $(+!true?yes|no)

rule10: $(+true?%YES|%NO)

rule11: ${+ot(Makefile,%FILE)?%YES|%NO}

rule12: $(+My-True?yes)

rule13: $(+false?yes)

rule14: $(+!true?yes)

=== $(+true)                # pass
--- command: make rule1
--- ^makefile
--- stdout: OK

=== $(+true!)               # pass / must
--- command: make rule2
--- ^makefile
--- stdout: OK

=== ${+true(1,"two",?tru)}  # args / pass
--- command: make rule3
--- ^makefile
--- stdout: OK

=== $(+!false)              # fail / negate
--- command: make rule4
--- ^makefile
--- stdout: OK

=== $(+true?yes)            # pass / then
--- command: make rule5
--- ^makefile
--- stdout: YES

=== $(+true?yes!)           # pass / then / must
--- command: make rule6
--- ^makefile
--- stdout: YES

=== $(+!true|yes)           # pass / negate / else
--- command: make rule7
--- ^makefile
--- stdout: YES

=== $(+false?yes|no)        # fail / then / else
--- command: make rule8
--- ^makefile
--- stdout: NO

=== $(+!true?yes|no)        # pass / negate / then / else
--- command: make rule9
--- ^makefile
--- stdout: NO

=== $(+true?%YES|%NO)       # pass / v-then / v-yes
--- command: make rule10
--- ^makefile
--- stdout: YES

=== $(+ot(file1,file2)?yes) # args / pass / then
--- command: make rule11
--- ^makefile
--- stdout: YES

=== $(+My-True?yes)         # inline
--- command: make rule12
--- ^makefile
--- stdout: YES

=== $(+false?yes)           # fail / (w/then) / nothing
--- command: make rule13
--- ^makefile
--- stdout: make[1]: Nothing to be done for 'rule13'.

=== $(+!true?yes)           # pass / negate / (w/then) / nothing
--- command: make rule14
--- ^makefile
--- stdout: make[1]: Nothing to be done for 'rule14'.
